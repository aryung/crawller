# Yahoo Finance Japan ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

Yahoo Finance Japan çˆ¬èŸ²æ˜¯å°ˆé–€é‡å°æ—¥æœ¬é›…è™è²¡ç¶“ç¶²ç«™è¨­è¨ˆçš„æ™ºèƒ½æ•¸æ“šæå–ç³»çµ±ï¼Œèƒ½å¤ è‡ªå‹•è§£æè‚¡ç¥¨è²¡å‹™è¡¨æ ¼ï¼Œä¸¦å°‡æ•¸æ“šè½‰æ›ç‚ºçµæ§‹åŒ–æ ¼å¼ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ¯ æ™ºèƒ½è¡¨æ ¼è§£æ
- è‡ªå‹•è­˜åˆ¥è²¡å‹™è¡¨æ ¼æ¨™é¡Œå’Œæ•¸æ“š
- å‹•æ…‹é©æ‡‰ä¸åŒå…¬å¸çš„è¡¨æ ¼çµæ§‹
- æ”¯æ´å¤šå¹´åº¦è²¡å‹™æ•¸æ“šæ¯”è¼ƒ

### ğŸ’± å–®ä½è‡ªå‹•è½‰æ›
- **ç™¾ä¸‡å††** â†’ å¯¦éš›é‡‘é¡ï¼ˆä¹˜ä»¥ 1,000,000ï¼‰
- **ç™¾åˆ†æ¯”** â†’ å°æ•¸æ ¼å¼ï¼ˆå¦‚ 1.96% â†’ 0.0196ï¼‰
- æ™ºèƒ½è­˜åˆ¥è¡¨æ ¼æ¨™é¡Œä¸­çš„å–®ä½è³‡è¨Š

### ğŸ“Š çµæ§‹åŒ–è¼¸å‡º
```json
{
  "stockInfo": "ã‚½ãƒ‹ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—(æ ª)ã®æ¥­ç¸¾ãƒ»è²¡å‹™ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼",
  "structuredPerformanceData": [
    {
      "fiscalPeriod": "2025å¹´3æœˆæœŸ",
      "revenue": 12034917000000,
      "grossProfit": 3530107000000,
      "grossMargin": 0.2933,
      "operatingProfit": 1407163000000,
      "operatingMargin": null,
      "ordinaryProfit": null,
      "ordinaryMargin": null,
      "netProfit": null,
      "accountingMethod": null,
      "updateDate": null
    }
  ]
}
```

## å¿«é€Ÿé–‹å§‹

### 1. å–®ä¸€è‚¡ç¥¨çˆ¬å–

```bash
# åŸ·è¡Œå–®ä¸€è‚¡ç¥¨ä»£ç¢¼
npm run crawl yahoo-finance-jp-7901_T

# è¼¸å‡ºæ–‡ä»¶æ ¼å¼
# output/yahoo-finance-jp-7901_T_crawl_results_20250731081859.json
```

### 2. æ‰¹é‡è‚¡ç¥¨è™•ç†

```bash
# ç”Ÿæˆæ‰¹è™•ç†é…ç½®
node scripts/generate-batch-configs.js

# åŸ·è¡Œæ‰¹é‡çˆ¬å–
node scripts/run-yahoo-finance-batch.js
```

## æ¶æ§‹èªªæ˜

### æ–‡ä»¶çµ„ç¹”çµæ§‹

```
/crawler/
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ templates/                              # é…ç½®æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ yahoo-finance-jp-performance.json   # ä¸»è¦æ¨¡æ¿
â”‚   â”œâ”€â”€ active/                                 # ç”Ÿæˆçš„é…ç½®
â”‚   â”‚   â”œâ”€â”€ yahoo-finance-jp-143A_T.json        # ã‚¤ã‚·ãƒ³(æ ª)
â”‚   â”‚   â”œâ”€â”€ yahoo-finance-jp-6758_T.json        # ã‚½ãƒ‹ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—
â”‚   â”‚   â”œâ”€â”€ yahoo-finance-jp-7203_T.json        # ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š
â”‚   â”‚   â”œâ”€â”€ yahoo-finance-jp-7901_T.json        # ãƒãƒ„ãƒ¢ãƒˆ
â”‚   â”‚   â””â”€â”€ yahoo-finance-jp-9984_T.json        # ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—
â”‚   â””â”€â”€ yahoo-finance-jp-*.json                 # åŸ·è¡Œé…ç½®ï¼ˆæ ¹ç›®éŒ„ï¼‰
â”œâ”€â”€ data/
â”‚   â””â”€â”€ yahoo-finance-jp-stockcodes.json        # è‚¡ç¥¨ä»£ç¢¼æ•¸æ“šæº
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ generate-batch-configs.js               # é…ç½®ç”Ÿæˆå™¨
â”‚   â””â”€â”€ run-yahoo-finance-batch.js              # æ‰¹è™•ç†åŸ·è¡Œå™¨
â””â”€â”€ output/
    â””â”€â”€ yahoo-finance-jp-*_crawl_results_*.json # çµæœè¼¸å‡º
```

### æ•¸æ“šæµç¨‹

```mermaid
graph LR
    A[æ¨¡æ¿æ–‡ä»¶] --> B[é…ç½®ç”Ÿæˆå™¨]
    C[è‚¡ç¥¨ä»£ç¢¼æ•¸æ“š] --> B
    B --> D[å€‹åˆ¥é…ç½®æ–‡ä»¶]
    D --> E[æ‰¹è™•ç†åŸ·è¡Œå™¨]
    E --> F[çˆ¬èŸ²å¼•æ“]
    F --> G[æ•¸æ“šè§£æå™¨]
    G --> H[å–®ä½è½‰æ›å™¨]
    H --> I[çµæ§‹åŒ–è¼¸å‡º]
```

## é…ç½®ç®¡ç†

### è‚¡ç¥¨ä»£ç¢¼æ•¸æ“šæº
æ–‡ä»¶ä½ç½®ï¼š`data/yahoo-finance-jp-stockcodes.json`

```json
[
  {
    "stockCode": "7901.T",
    "companyName": "(æ ª)ãƒãƒ„ãƒ¢ãƒˆ",
    "sector": "å°å£²æ¥­"
  },
  {
    "stockCode": "143A.T", 
    "companyName": "ã‚¤ã‚·ãƒ³(æ ª)",
    "sector": "é£Ÿæ–™å“"
  }
]
```

### é…ç½®æ¨¡æ¿
æ–‡ä»¶ä½ç½®ï¼š`configs/templates/yahoo-finance-jp-performance.json`

ä¸»è¦é…ç½®é …ç›®ï¼š
- **URL æ¨¡æ¿**ï¼š`https://finance.yahoo.co.jp/quote/${stockCode}/performance?styl=performance`
- **é¸æ“‡å™¨**ï¼šè¡¨æ ¼æ•¸æ“šæå–è¦å‰‡
- **è½‰æ›å™¨**ï¼š`structureFinancialDataFromAllTableCells` å‡½æ•¸
- **è¼¸å‡ºè¨­ç½®**ï¼šJSON æ ¼å¼ï¼Œè‡ªå®šç¾©æ–‡ä»¶å

## ä½¿ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šæ–°å¢è‚¡ç¥¨ä»£ç¢¼

1. ç·¨è¼¯ `data/yahoo-finance-jp-stockcodes.json`ï¼š
```json
[
  {
    "stockCode": "4755.T",
    "companyName": "æ¥½å¤©ã‚°ãƒ«ãƒ¼ãƒ—(æ ª)",
    "sector": "æƒ…å ±ãƒ»é€šä¿¡æ¥­"
  }
]
```

2. é‡æ–°ç”Ÿæˆé…ç½®ï¼š
```bash
node scripts/generate-batch-configs.js
```

3. åŸ·è¡Œçˆ¬å–ï¼š
```bash
npm run crawl yahoo-finance-jp-4755_T
```

### æ¡ˆä¾‹ 2ï¼šä¿®æ”¹è¼¸å‡ºæ ¼å¼

ç·¨è¼¯æ¨¡æ¿æ–‡ä»¶ `configs/templates/yahoo-finance-jp-performance.json`ï¼š

```json
{
  "export": {
    "formats": ["json", "csv"],
    "filename": "financial_data_${stockCode}"
  }
}
```

### æ¡ˆä¾‹ 3ï¼šè‡ªå®šç¾©ç­‰å¾…æ™‚é–“

```json
{
  "options": {
    "domainDelay": 8000,
    "waitFor": 3000
  }
}
```

## æ•¸æ“šçµæ§‹èªªæ˜

### è¼¸å‡ºæ¬„ä½å°æ‡‰

| ä¸­æ–‡æ¬„ä½ | è‹±æ–‡æ¬„ä½ | å–®ä½è½‰æ› | èªªæ˜ |
|---------|---------|---------|------|
| å£²ä¸Šé«˜ | revenue | ç™¾ä¸‡å†† Ã— 1,000,000 | ç‡Ÿæ¥­æ”¶å…¥ |
| å£²ä¸Šç·åˆ©ç›Š | grossProfit | ç™¾ä¸‡å†† Ã— 1,000,000 | æ¯›åˆ©æ½¤ |
| å£²ä¸Šç·åˆ©ç›Šç‡ | grossMargin | % Ã· 100 | æ¯›åˆ©ç‡ |
| å–¶æ¥­åˆ©ç›Š | operatingProfit | ç™¾ä¸‡å†† Ã— 1,000,000 | ç‡Ÿæ¥­åˆ©æ½¤ |
| å–¶æ¥­åˆ©ç›Šç‡ | operatingMargin | % Ã· 100 | ç‡Ÿæ¥­åˆ©æ½¤ç‡ |
| çµŒå¸¸åˆ©ç›Š | ordinaryProfit | ç™¾ä¸‡å†† Ã— 1,000,000 | ç¶“å¸¸åˆ©æ½¤ |
| çµŒå¸¸åˆ©ç›Šç‡ | ordinaryMargin | % Ã· 100 | ç¶“å¸¸åˆ©æ½¤ç‡ |
| ç´”åˆ©ç›Š | netProfit | ç™¾ä¸‡å†† Ã— 1,000,000 | æ·¨åˆ©æ½¤ |

### å–®ä½è­˜åˆ¥é‚è¼¯

ç³»çµ±æœƒè‡ªå‹•åˆ†æè¡¨æ ¼æ¨™é¡Œä¾†æ±ºå®šå–®ä½è½‰æ›ï¼š

```javascript
// ç™¾ä¸‡å†† ç›¸é—œæ¨™é¡Œ
if (header.includes('ç™¾ä¸‡å††') || header.includes('ç™¾è¬åœ“')) {
  multiplier = 1000000;
}

// ç™¾åˆ†æ¯”ç›¸é—œæ¨™é¡Œ  
if (header.includes('%') || header.includes('ç‡')) {
  multiplier = 0.01;
}
```

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. è‚¡ç¥¨ä»£ç¢¼æ ¼å¼éŒ¯èª¤
**ç—‡ç‹€**ï¼š404 éŒ¯èª¤æˆ–ç„¡æ³•æ‰¾åˆ°é é¢
**è§£æ±º**ï¼šç¢ºèªè‚¡ç¥¨ä»£ç¢¼æ ¼å¼æ­£ç¢ºï¼ˆå¦‚ `7901.T`ï¼‰

#### 2. è¡¨æ ¼è§£æå¤±æ•—
**ç—‡ç‹€**ï¼š`structuredPerformanceData` ç‚ºç©º
**è§£æ±º**ï¼šæª¢æŸ¥ç¶²ç«™çµæ§‹æ˜¯å¦è®Šæ›´ï¼Œæ›´æ–°é¸æ“‡å™¨é…ç½®

#### 3. å–®ä½è½‰æ›ç•°å¸¸
**ç—‡ç‹€**ï¼šæ•¸å€¼éå¤§æˆ–éå°
**è§£æ±º**ï¼šæª¢æŸ¥ `src/const/finance.ts` ä¸­çš„å–®ä½æ˜ å°„

#### 4. æ‰¹è™•ç†ä¸­æ–·
**ç—‡ç‹€**ï¼šéƒ¨åˆ†è‚¡ç¥¨è™•ç†æˆåŠŸï¼Œéƒ¨åˆ†å¤±æ•—
**è§£æ±º**ï¼šæª¢æŸ¥ç¶²çµ¡é€£æ¥ï¼Œé©ç•¶å¢åŠ å»¶é²æ™‚é–“

### é™¤éŒ¯æŠ€å·§

#### å•Ÿç”¨è©³ç´°æ—¥èªŒ
```bash
DEBUG=true npm run crawl yahoo-finance-jp-7901_T
```

#### æª¢æŸ¥ç¶²é å…§å®¹
```bash
# å•Ÿç”¨æˆªåœ–åŠŸèƒ½
"options": {
  "screenshot": true
}
```

#### æ‰‹å‹•æ¸¬è©¦å–®ä¸€é…ç½®
```bash
# æ¸¬è©¦ç‰¹å®šé…ç½®
npm run crawl yahoo-finance-jp-7901_T
```

## é€²éšåŠŸèƒ½

### è‡ªå®šç¾©è½‰æ›å‡½æ•¸

åœ¨ `src/transforms/sites/yahoo-finance-jp.ts` ä¸­æ–°å¢ï¼š

```javascript
export function customFinancialTransform(data: any[]): any {
  // è‡ªå®šç¾©è½‰æ›é‚è¼¯
  return processedData;
}
```

### æ–°å¢è²¡å‹™æŒ‡æ¨™

ä¿®æ”¹ `src/const/finance.ts`ï¼š

```javascript
export const FINANCIAL_HEADERS = {
  // ç¾æœ‰æ¬„ä½...
  'ROE': 'returnOnEquity',
  'ROA': 'returnOnAssets'
};
```

### å¤šå¹´åº¦æ¯”è¼ƒåˆ†æ

ç³»çµ±å·²æ”¯æ´å¤šå¹´åº¦æ•¸æ“šæ¯”è¼ƒï¼Œè¼¸å‡ºæ ¼å¼æœƒåŒ…å«æ­·å²æ•¸æ“šé™£åˆ—ã€‚

## æ€§èƒ½å„ªåŒ–

### å»ºè­°è¨­ç½®

```json
{
  "options": {
    "timeout": 30000,
    "retries": 3,
    "domainDelay": 5000,
    "concurrent": 1
  }
}
```

### æ‰¹è™•ç†æœ€ä½³å¯¦è¸

1. **é †åºåŸ·è¡Œ**ï¼šé¿å…ä¸¦ç™¼è«‹æ±‚å°è‡´ IP å°é–
2. **é©ç•¶å»¶é²**ï¼šæ‰¹è™•ç†è…³æœ¬å·²å…§å»º 3 ç§’å»¶é²
3. **éŒ¯èª¤é‡è©¦**ï¼šé…ç½®é©ç•¶çš„é‡è©¦æ¬¡æ•¸
4. **ç›£æ§æ—¥èªŒ**ï¼šå®šæœŸæª¢æŸ¥åŸ·è¡Œç‹€æ³

## ç‰ˆæœ¬æ›´æ–°è¨˜éŒ„

### v1.0.0 (2025-07-31)
- âœ… æ™ºèƒ½è¡¨æ ¼è§£æåŠŸèƒ½
- âœ… å–®ä½è‡ªå‹•è½‰æ›
- âœ… æ‰¹è™•ç†æ¶æ§‹
- âœ… æª”æ¡ˆå‘½åæ ¼å¼å„ªåŒ– (yyyymmddhhmmss)
- âœ… æ•¸æ“šçµæ§‹ç°¡åŒ–

### æœªä¾†è¨ˆåŠƒ
- æ”¯æ´æ›´å¤šè²¡å‹™æŒ‡æ¨™
- å¢åŠ æ•¸æ“šé©—è­‰æ©Ÿåˆ¶
- æä¾› API æ¥å£
- æ”¯æ´å³æ™‚æ•¸æ“šæ›´æ–°

## è¯ç¹«æ”¯æ´

å¦‚é‡åˆ°å•é¡Œæˆ–éœ€è¦åŠŸèƒ½å»ºè­°ï¼Œè«‹ï¼š

1. æª¢æŸ¥æœ¬æ–‡ä»¶çš„æ•…éšœæ’é™¤ç« ç¯€
2. æŸ¥çœ‹ `logs/` ç›®éŒ„ä¸‹çš„è©³ç´°æ—¥èªŒ
3. è¯ç¹«é–‹ç™¼åœ˜éšŠ

---

*æœ€å¾Œæ›´æ–°ï¼š2025-07-31*