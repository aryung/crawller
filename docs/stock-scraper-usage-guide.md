# è‚¡ç¥¨çˆ¬èŸ²è…³æœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°ˆé–€ä»‹ç´¹å¦‚ä½•ä½¿ç”¨è‚¡ç¥¨çˆ¬èŸ²è…³æœ¬ (`scrape-yahoo-jp-stock-details.js` å’Œ `scrape-yahoo-tw-stock-details.js`) é€²è¡Œå¤§è¦æ¨¡è‚¡ç¥¨æ•¸æ“šæ¡é›†ã€‚é€™äº›è…³æœ¬æ”¯æ´æ™ºèƒ½åˆ†é è™•ç†ã€æ‰¹é‡æ•¸æ“šæå–ï¼Œä¸¦æä¾›è±å¯Œçš„å‘½ä»¤è¡Œåƒæ•¸é…ç½®ã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å®‰è£ä¾è³´
```bash
cd /Users/aryung/Downloads/Workshop/crawler
npm install
```

### åŸºæœ¬åŸ·è¡Œ
```bash
# Yahoo Japan è‚¡ç¥¨çˆ¬èŸ²
npx tsx scripts/scrape-yahoo-jp-stock-details.ts

# Yahoo Taiwan è‚¡ç¥¨çˆ¬èŸ² (å¦‚æœå­˜åœ¨)
npx tsx scripts/scrape-yahoo-tw-stock-details.ts
```

## ğŸ”§ Yahoo Japan è‚¡ç¥¨çˆ¬èŸ²è©³è§£

### è…³æœ¬æ¦‚è¿°
- **æ–‡ä»¶ä½ç½®**: `scripts/scrape-yahoo-jp-stock-details.js`
- **æ ¸å¿ƒåŠŸèƒ½**: æ™ºèƒ½åˆ†é è™•ç†ï¼Œå¾å–®é  20 è‚¡ç¥¨æå‡åˆ°å¤šé  127+ è‚¡ç¥¨
- **è™•ç†æ¨¡å¼**: åŸºæ–¼ç¸½ç­†æ•¸è¨ˆç®—çš„æ™ºèƒ½åˆ†é ç­–ç•¥

### å‘½ä»¤è¡Œåƒæ•¸

#### 1. åŸºæœ¬åƒæ•¸
```bash
# é™åˆ¶è™•ç†åˆ†é¡æ•¸é‡
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --limit=5

# æŒ‡å®šç‰¹å®šåˆ†é¡ ID
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --category=food

# è¨­ç½®ä¸¦ç™¼æ•¸é‡ (å»ºè­°ä¿æŒ 1 é¿å… IP å°é–)
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --concurrent=1
```

#### 2. åˆ†é æ§åˆ¶åƒæ•¸
```bash
# é™åˆ¶æœ€å¤§é æ•¸
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --max-pages=5

# æ¸¬è©¦æ¨¡å¼ (åªè™•ç†å‰ 2 é )
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --test-mode
```

#### 3. åƒæ•¸çµ„åˆä½¿ç”¨
```bash
# æ¸¬è©¦ç‰¹å®šåˆ†é¡çš„å‰ 3 é 
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --category=food --test-mode --max-pages=3

# æ‰¹é‡è™•ç†å‰ 10 å€‹åˆ†é¡ï¼Œæ¯å€‹åˆ†é¡æœ€å¤š 7 é 
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --limit=10 --max-pages=7
```

### è¼¸å‡ºçµæœ

#### æ§åˆ¶å°è¼¸å‡ºç¯„ä¾‹
```bash
ğŸ” Yahoo Japan è‚¡ç¥¨è©³ç´°è³‡æ–™çˆ¬èŸ²å•Ÿå‹•
====================================
ğŸ¯ æŒ‡å®šåˆ†é¡: food
ğŸ§ª æ¸¬è©¦æ¨¡å¼: åªè™•ç†å‰ 2 é 
âš¡ ä¸¦ç™¼æ•¸é‡: 1
ğŸ“„ æœ€å¤§é æ•¸: 2

ğŸ“„ é–‹å§‹è™•ç†åˆ†é¡: é£Ÿå“ (ID: food)
ğŸ”— åŸºç¤ URL: https://finance.yahoo.co.jp/stocks/search/?sector=food&page=1

ğŸ“Š æ™ºèƒ½åˆ†é è¨ˆç®—:
   ç¸½ç­†æ•¸: 128 ä»¶
   æ¯é ç­†æ•¸: 20
   è¨ˆç®—é æ•¸: 7 é 
   ç•¶å‰é : 1

âœ… ç¬¬ 1 é : 20 æ”¯è‚¡ç¥¨ (ç´¯è¨ˆ: 20)
âœ… ç¬¬ 2 é : 20 æ”¯è‚¡ç¥¨ (ç´¯è¨ˆ: 40)

ğŸ¯ é£Ÿå“ å®Œæˆ: é æœŸ 7 é ï¼Œå¯¦éš›è™•ç† 2 é ï¼Œæå– 40 æ”¯è‚¡ç¥¨

âœ… æ—¥è‚¡çˆ¬å–å®Œæˆï¼
====================================
ğŸ“„ çµæœæ–‡ä»¶: /output/yahoo-jp-stock-details_2025-08-05T08-30-15.json
ğŸ“Š è™•ç†åˆ†é¡: 1
âœ… æˆåŠŸåˆ†é¡: 1
ğŸ“„ ç¸½è™•ç†é æ•¸: 2
ğŸ¯ ç¸½è‚¡ç¥¨æ•¸: 40
```

#### è¼¸å‡ºæ–‡ä»¶çµæ§‹
```json
{
  "food": [
    {
      "name": "(æ ª)ãƒ‹ãƒƒãƒ—ãƒ³",
      "symbolCode": "2001.T"
    },
    {
      "name": "æ—¥æ¸…è£½ç²‰ã‚°ãƒ«ãƒ¼ãƒ—æœ¬ç¤¾(æ ª)",
      "symbolCode": "2002.T"
    }
  ],
  "_metadata": {
    "food": {
      "categoryName": "é£Ÿå“",
      "totalPages": 2,
      "expectedPages": 7,
      "totalStocks": 40,
      "scrapedAt": "2025-08-05T08:30:15.000Z",
      "paginationMethod": "smartPagination"
    }
  }
}
```

### æ™ºèƒ½åˆ†é ç­–ç•¥èªªæ˜

#### å·¥ä½œåŸç†
1. **é¦–é åˆ†æ**: å¾é¦–é è§£æ "121ï½128 / 128ä»¶" æ ¼å¼ç²å–ç¸½ç­†æ•¸
2. **é æ•¸è¨ˆç®—**: ç¸½ç­†æ•¸ Ã· æ¯é  20 ç­† = ç¸½é æ•¸
3. **ç›´æ¥è¨ªå•**: ç›´æ¥è¨ªå• `page=1`, `page=2`, ..., `page=N` çš„ URL
4. **æ•¸æ“šæå–**: æ¯é æå–è‚¡ç¥¨ä»£ç¢¼å’Œå…¬å¸åç¨±

#### æ”¯æ´çš„åˆ†é æ ¼å¼
- `"121ï½128 / 128ä»¶"` - æ—¥æ–‡æ¨™æº–æ ¼å¼
- `"1ï½20 / 161ä»¶"` - å¤šé åˆ†é¡æ ¼å¼  
- `"1-20 of 128"` - è‹±æ–‡å‚™ç”¨æ ¼å¼

#### åˆ†é é‚è¼¯ç¤ºä¾‹
```javascript
// å¯¦éš›è¨ˆç®—éç¨‹
ç¸½ç­†æ•¸: 128 ä»¶
æ¯é ç­†æ•¸: 20 (Yahoo Finance Japan å›ºå®š)
è¨ˆç®—: Math.ceil(128 / 20) = Math.ceil(6.4) = 7 é 

// URL è¨ªå•é †åº
page=1 â†’ æå– 1-20 è‚¡ç¥¨
page=2 â†’ æå– 21-40 è‚¡ç¥¨
...
page=7 â†’ æå– 121-128 è‚¡ç¥¨ (æœ€å¾Œ8æ”¯)
```

## ğŸ¯ æ•¸æ“šå“è³ªæ§åˆ¶

### å…¬å¸åç¨±æ¸…ç†
è…³æœ¬æœƒè‡ªå‹•æ¸…ç†å…¬å¸åç¨±ä¸­çš„ç„¡é—œä¿¡æ¯ï¼š

```javascript
æ¸…ç†å‰: "2001æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ æ—¥æ¸…è£½ç²‰ã‚°ãƒ«ãƒ¼ãƒ—æœ¬ç¤¾1,787.5+15.0(+0.85%)8/5"
æ¸…ç†å¾Œ: "æ—¥æ¸…è£½ç²‰ã‚°ãƒ«ãƒ¼ãƒ—æœ¬ç¤¾(æ ª)"

æ¸…ç†é …ç›®:
- è‚¡ç¥¨ä»£ç¢¼ (2001)
- äº¤æ˜“æ‰€æ¨™è¨˜ (æ±è¨¼ãƒ—ãƒ©ã‚¤ãƒ )  
- åƒ¹æ ¼ä¿¡æ¯ (1,787.5)
- æ¼²è·Œå¹… (+15.0, +0.85%)
- æ—¥æœŸ (8/5)
```

### æ•¸æ“šé©—è­‰
```javascript
// è‚¡ç¥¨ä»£ç¢¼æ ¼å¼é©—è­‰
æœ‰æ•ˆæ ¼å¼: "2001.T", "7203.T", "143A.T"
ç„¡æ•ˆæ ¼å¼: "2001", "ABC", "12345.T"

// å…¬å¸åç¨±é©—è­‰
æœ‰æ•ˆé•·åº¦: 1-50 å­—ç¬¦
æ’é™¤è©èª: ["è©³ç´°", "æ ªä¾¡", "ãƒãƒ£ãƒ¼ãƒˆ", "æ™‚ç³»åˆ—"]
```

## ğŸ” é™¤éŒ¯èˆ‡æ•…éšœæ’é™¤

### å•Ÿç”¨è©³ç´°æ—¥èªŒ
```bash
# é¡¯ç¤ºæ‰€æœ‰èª¿è©¦ä¿¡æ¯
DEBUG=true npx tsx scripts/scrape-yahoo-jp-stock-details.ts --test-mode
```

### å¸¸è¦‹å•é¡Œ

#### 1. ç„¡æ³•æª¢æ¸¬åˆ†é ä¿¡æ¯
**ç—‡ç‹€**: é¡¯ç¤º `{"hasMore":false,"method":"singlePage"}`

**æ’æŸ¥æ­¥é©Ÿ**:
```bash
# 1. æª¢æŸ¥ç¶²ç«™æ˜¯å¦å¯è¨ªå•
curl -I "https://finance.yahoo.co.jp/stocks/search/?sector=food"

# 2. ä½¿ç”¨æ¸¬è©¦æ¨¡å¼æª¢æŸ¥
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --category=food --test-mode

# 3. æª¢æŸ¥åˆ†é¡ ID æ˜¯å¦æ­£ç¢º
# ç¢ºèª category ID å­˜åœ¨æ–¼åˆ†é¡æ•¸æ“šæ–‡ä»¶ä¸­
```

#### 2. æå–è‚¡ç¥¨æ•¸é‡ç‚º 0
**ç—‡ç‹€**: `æœ¬é æå–å®Œæˆ: 0 æ”¯è‚¡ç¥¨`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# æª¢æŸ¥ CSS é¸æ“‡å™¨æ˜¯å¦é©ç”¨
# è…³æœ¬å·²å…§å»ºå¤šå±¤é¸æ“‡å™¨ç­–ç•¥ï¼Œé€šå¸¸æœƒè‡ªå‹•ä¿®å¾©

# å¦‚æœæŒçºŒå‡ºç¾ï¼Œæª¢æŸ¥ç¶²ç«™çµæ§‹æ˜¯å¦è®Šæ›´
# æŸ¥çœ‹è¼¸å‡ºæ—¥èªŒä¸­çš„é¸æ“‡å™¨æ¸¬è©¦çµæœ
```

#### 3. ç¶²çµ¡è¶…æ™‚éŒ¯èª¤
**ç—‡ç‹€**: `timeout` æˆ– `connection refused`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# 1. å¢åŠ è«‹æ±‚é–“éš”
# è…³æœ¬é è¨­ 2 ç§’é–“éš”ï¼Œå¯åœ¨ä»£ç¢¼ä¸­èª¿æ•´

# 2. ä½¿ç”¨æ¸¬è©¦æ¨¡å¼æ¸›å°‘è² è¼‰
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --test-mode

# 3. åˆ†æ‰¹è™•ç†
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --limit=3
```

#### 4. åˆ†é¡æ•¸æ“šæ–‡ä»¶ä¸å­˜åœ¨
**ç—‡ç‹€**: `æ‰¾ä¸åˆ°æ—¥è‚¡åˆ†é¡æ•¸æ“šæ–‡ä»¶`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# å…ˆé‹è¡Œåˆ†é¡çˆ¬èŸ²
npx tsx scripts/scrape-yahoo-jp-stock-categories.ts

# ç¢ºèªè¼¸å‡ºæ–‡ä»¶å­˜åœ¨
ls -la output/yahoo-jp-stock-categories*.json
```

## ğŸ“Š æ€§èƒ½å„ªåŒ–å»ºè­°

### æœ€ä½³å¯¦è¸è¨­ç½®
```bash
# æ¨è–¦é…ç½®ï¼šå–®ç·šç¨‹ã€é©åº¦é™åˆ¶
npx tsx scripts/scrape-yahoo-jp-stock-details.ts \
  --concurrent=1 \
  --max-pages=10 \
  --limit=5
```

### å¤§è¦æ¨¡æ¡é›†ç­–ç•¥
```bash
# åˆ†æ‰¹åŸ·è¡Œï¼Œé¿å… IP å°é–
# ç¬¬ä¸€æ‰¹ï¼šå‰ 5 å€‹åˆ†é¡
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --limit=5

# ç­‰å¾… 30 åˆ†é˜å¾ŒåŸ·è¡Œç¬¬äºŒæ‰¹
# (æ‰‹å‹•æˆ–ä½¿ç”¨ cron job)
```

### ç›£æ§å»ºè­°
1. **æª¢æŸ¥è¼¸å‡ºè³ªé‡**: å®šæœŸé©—è­‰æå–çš„è‚¡ç¥¨ä»£ç¢¼æ ¼å¼
2. **ç›£æ§æˆåŠŸç‡**: é—œæ³¨ "æˆåŠŸåˆ†é¡" æ•¸é‡
3. **æ€§èƒ½è¿½è¹¤**: è¨˜éŒ„æ¯å€‹åˆ†é¡çš„è™•ç†æ™‚é–“
4. **æ•¸æ“šå®Œæ•´æ€§**: æ¯”è¼ƒé æœŸé æ•¸å’Œå¯¦éš›è™•ç†é æ•¸

## ğŸ”§ é€²éšä½¿ç”¨

### è‡ªå®šç¾©åˆ†é¡è™•ç†
```bash
# 1. æŸ¥çœ‹å¯ç”¨åˆ†é¡
cat output/yahoo-jp-stock-categories_*.json | jq 'keys'

# 2. è™•ç†ç‰¹å®šåˆ†é¡
npx tsx scripts/scrape-yahoo-jp-stock-details.ts --category=construction

# 3. æ‰¹é‡è™•ç†ç‰¹å®šé¡å‹
# åœ¨è…³æœ¬ä¸­ä¿®æ”¹åˆ†é¡éæ¿¾é‚è¼¯
```

### çµåˆå…¶ä»–è…³æœ¬
```bash
# 1. å…ˆç²å–åˆ†é¡
npx tsx scripts/scrape-yahoo-jp-stock-categories.ts

# 2. å†è™•ç†è©³ç´°æ•¸æ“š
npx tsx scripts/scrape-yahoo-jp-stock-details.ts

# 3. å¾ŒçºŒæ•¸æ“šè™•ç†
# ä½¿ç”¨è¼¸å‡ºæ–‡ä»¶é€²è¡Œé€²ä¸€æ­¥åˆ†æ
```

### æ•¸æ“šæ ¼å¼è½‰æ›
```bash
# ä½¿ç”¨ jq æå–ç‰¹å®šåˆ†é¡è‚¡ç¥¨åˆ—è¡¨
cat output/yahoo-jp-stock-details_*.json | jq '.food'

# æå–æ‰€æœ‰è‚¡ç¥¨ä»£ç¢¼
cat output/yahoo-jp-stock-details_*.json | jq -r '.food[]?.symbolCode'

# çµ±è¨ˆå„åˆ†é¡è‚¡ç¥¨æ•¸é‡
cat output/yahoo-jp-stock-details_*.json | jq '._metadata | to_entries[] | {category: .key, count: .value.totalStocks}'
```

## ğŸ“ è¼¸å‡ºæ–‡ä»¶ç®¡ç†

### æ–‡ä»¶å‘½åè¦å‰‡
```
æ ¼å¼: yahoo-jp-stock-details_YYYY-MM-DDTHH-MM-SS.json
ç¯„ä¾‹: yahoo-jp-stock-details_2025-08-05T08-30-15.json
æ™‚å€: æœ¬åœ°æ™‚å€
```

### æ–‡ä»¶çµæ§‹èªªæ˜
```json
{
  "åˆ†é¡ID": [
    {
      "name": "å…¬å¸åç¨±",
      "symbolCode": "è‚¡ç¥¨ä»£ç¢¼.T"
    }
  ],
  "_metadata": {
    "åˆ†é¡ID": {
      "categoryName": "åˆ†é¡ä¸­æ–‡å",
      "totalPages": "å¯¦éš›è™•ç†é æ•¸",
      "expectedPages": "è¨ˆç®—çš„ç¸½é æ•¸",
      "totalStocks": "æå–è‚¡ç¥¨ç¸½æ•¸",
      "scrapedAt": "ISO 8601 æ™‚é–“æˆ³",
      "paginationMethod": "smartPagination"
    }
  }
}
```

### æ–‡ä»¶æ¸…ç†å»ºè­°
```bash
# ä¿ç•™æœ€æ–°çš„ 5 å€‹çµæœæ–‡ä»¶
ls -t output/yahoo-jp-stock-details_*.json | tail -n +6 | xargs rm

# æŒ‰æ—¥æœŸæ­¸æª”
mkdir -p archive/$(date +%Y-%m)
mv output/yahoo-jp-stock-details_2025-08-*.json archive/2025-08/
```

## ğŸŒ Yahoo Taiwan è‚¡ç¥¨çˆ¬èŸ² (å¦‚é©ç”¨)

å¦‚æœå­˜åœ¨ Taiwan è‚¡ç¥¨çˆ¬èŸ²è…³æœ¬ï¼Œä½¿ç”¨æ–¹æ³•é¡ä¼¼ï¼š

```bash
# åŸºæœ¬åŸ·è¡Œ
npx tsx scripts/scrape-yahoo-tw-stock-details.ts

# åƒæ•¸å¯èƒ½åŒ…æ‹¬
npx tsx scripts/scrape-yahoo-tw-stock-details.ts --limit=10 --test-mode
```

å…·é«”åƒæ•¸å’ŒåŠŸèƒ½éœ€è¦æ ¹æ“šå¯¦éš›è…³æœ¬å¯¦ç¾é€²è¡Œèª¿æ•´ã€‚

## ğŸ“ æ”¯æ´èˆ‡è¯ç¹«

### å•é¡Œå ±å‘Š
1. **æª¢æŸ¥æ—¥èªŒ**: æŸ¥çœ‹æ§åˆ¶å°è¼¸å‡ºå’Œè©³ç´°æ—¥èªŒ
2. **æ¸¬è©¦æ¨¡å¼**: ä½¿ç”¨ `--test-mode` é€²è¡Œå¿«é€Ÿè¨ºæ–·
3. **ç¶²çµ¡æª¢æŸ¥**: ç¢ºèªç›®æ¨™ç¶²ç«™å¯æ­£å¸¸è¨ªå•
4. **æ–‡æª”åƒè€ƒ**: æŸ¥é–±æœ¬æŒ‡å—å’Œé–‹ç™¼æ–‡æª”

### åŠŸèƒ½è«‹æ±‚
- æ–°å¢åˆ†é¡æ”¯æ´
- é¡å¤–æ•¸æ“šæ¬„ä½æå–
- æ€§èƒ½å„ªåŒ–å»ºè­°
- è¼¸å‡ºæ ¼å¼æ“´å±•

---

**æœ€å¾Œæ›´æ–°**: 2025-08-05  
**é©ç”¨ç‰ˆæœ¬**: v2.1.0  
**æ ¸å¿ƒåŠŸèƒ½**: æ™ºèƒ½åˆ†é ç­–ç•¥ï¼Œ6.35x æ•¸æ“šæå–æ•ˆç‡æå‡ ğŸš€